# 2025-12-17

## What was accomplished

Implemented multiple visualizations per property feature.

### Changes

1. **Data Model** (`column-config.types.ts`):
    - Added `id: string` field to `ColumnVisualizationConfig`
    - Changed `ColumnConfigMap` from `Record<PropertyId, Config>` to `Record<PropertyId, Config[]>`
    - Added `LegacyColumnConfigMap` type for migration
    - Added `generateVisualizationId()` function using `crypto.randomUUID()`

2. **ColumnConfigService** (`column-config.service.ts`):
    - Added automatic migration from legacy single-config format to array format
    - Added `addVisualization(propertyId, sourceVisualizationId)` - copies settings from source
    - Added `removeVisualization(propertyId, visualizationId)` - only if 2+ exist
    - Added `getPropertyConfigs(propertyId)` - returns all configs for a property
    - Added `getVisualizationConfig(propertyId, vizId)` - returns specific config
    - Added `getEffectiveConfigs(propertyId, displayName)` - returns all effective configs
    - Added `updateVisualizationConfig(propertyId, vizId, updates)`
    - Added `resetVisualizationConfig(propertyId, vizId)`

3. **Context Menu** (`card-context-menu.ts`):
    - Added `canRemove: boolean` parameter
    - Added "Add visualization" button (always visible)
    - Added "Remove" button (only visible when `canRemove=true`)
    - Added `addVisualization` and `removeVisualization` actions

4. **LifeTrackerView** (`life-tracker-view.ts`):
    - Changed `visualizations` Map key from `BasesPropertyId` to visualization ID
    - Visualization entries now include `propertyId` field
    - Added `data-visualization-id` attribute to card elements
    - Renders all visualizations for each property
    - Context menu handlers pass visualization ID
    - Simplified refresh methods to use full refresh for multi-viz scenarios

5. **MaximizeStateService** (`maximize-state.service.ts`):
    - Updated to work with new visualization entry format
    - Iterates by property ID for maximize/minimize operations

### Key Decisions

- **Add visualization behavior**: Copies all settings from the clicked visualization
- **Remove button visibility**: Only shown when property has 2+ visualizations
- **Cannot remove last visualization**: Ensures property always has at least one visualization
- **Migration**: Automatic migration from old single-config format on first load

### Documentation Updates

- Updated `Domain Model.md` with new `id` field and 1:N relationship
- Updated `Configuration.md` with multi-visualization details
